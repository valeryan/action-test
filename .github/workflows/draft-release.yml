name: Draft Release

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  draft_release:
    runs-on: ubuntu-latest

    steps:
      # Get the current Zulu date in YYYY.MM.DD.HHMMZ format
      - name: Get Zulu time
        id: zulu_time
        run: |
          ZULU_DATE=$(date -u +"%Y.%m.%d.%H%MZ")
          echo "zulu_time=$ZULU_DATE" >> $GITHUB_ENV

      # Draft the release using GitHub API with auto-generated changelog
      - name: Create Draft Release
        id: create_release
        uses: octokit/request-action@v2.x
        with:
          route: POST /repos/${{ github.repository }}/releases
          mediaType: |
            format=json
          body: |
            {
              "tag_name": "${{ env.zulu_time }}",
              "name": "${{ env.zulu_time }}",
              "body": null,
              "draft": true,
              "generate_release_notes": true
            }
          headers: '{"authorization": "token ${{ secrets.GITHUB_TOKEN }}"}'
